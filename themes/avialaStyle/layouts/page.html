{{ define "main" }}
<div class="page">
  <div class="previewImg" style="background-image: url('{{ .Params.preview }}');"></div>

  <h1>{{ .Title }}</h1>
  <div class="docInfo">
  {{ $dateHuman := .Date | time.Format "2006年1月2日" }}
  {{ $dateMachine := .Date | time.Format "2006-01-02T15:04:05-07:00" }}
  {{ partial "terms-no-title.html" (dict "taxonomy" "tags" "page" .) }}
  <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time>
  {{ if .Params.author }}
    <span class="author">作者：{{ .Params.author }}</span>
  {{ else if .Site.Params.author }}
    <span class="author">作者：{{ .Site.Params.author }}</span>
  {{ end }}
  </div>

  <div class="articleShare">
    <div class="uui-iconplace theme">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path d="M7.46672 2.85952C7.46672 1.37839 9.3058 0.692325 10.2758 1.8116L14.7258 6.94625C15.2503 7.55146 15.2466 8.4513 14.7171 9.05211L10.2671 14.1011C9.29215 15.2072 7.4668 14.5177 7.46672 13.0433V11.158C7.46672 11.068 7.42547 11.002 7.37792 10.9668C7.33509 10.9352 7.28713 10.9258 7.22896 10.9494C5.76945 11.5412 4.21786 12.6434 2.84198 13.7274C2.38584 14.0867 1.81119 14.0981 1.38026 13.8516C0.939512 13.5994 0.66381 13.0821 0.808127 12.4899C1.56847 9.37008 3.44959 6.55258 7.26893 5.03622C7.39583 4.98582 7.46667 4.87224 7.46672 4.76434V2.85952Z" fill="white"/>
      </svg>
    </div>
    <div class="uui-typeface">
      <p>如果你想支持我们，请考虑分享这篇文章</p>
      <p class="caption">让更多人看到这篇文章</p>
    </div>
    <button class="uui-button Regular Second shareButton" onclick="copyShareLink()">复制分享链接</button>
  </div>

  {{ .Content }}
  
  </div>

<script>
function copyShareLink() {
  const url = window.location.href;
  const button = document.querySelector('.shareButton');
  
  // 使用现代的 Clipboard API
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(url).then(function() {
      showCopySuccess(button);
    }).catch(function(err) {
      console.error('复制失败: ', err);
      fallbackCopyTextToClipboard(url, button);
    });
  } else {
    // 降级方案
    fallbackCopyTextToClipboard(url, button);
  }
}

function fallbackCopyTextToClipboard(text, button) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  
  // 避免滚动到底部
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";
  textArea.style.opacity = "0";
  
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    const successful = document.execCommand('copy');
    if (successful) {
      showCopySuccess(button);
    } else {
      showCopyError(button);
    }
  } catch (err) {
    console.error('复制失败: ', err);
    showCopyError(button);
  }
  
  document.body.removeChild(textArea);
}

function showCopySuccess(button) {
  const originalText = button.textContent;
  button.textContent = '已复制到剪贴板';
  
  setTimeout(function() {
    button.textContent = originalText;
  }, 2000);
}

function showCopyError(button) {
  const originalText = button.textContent;
  button.textContent = '复制失败';
  
  setTimeout(function() {
    button.textContent = originalText;
  }, 2000);
}
</script>
{{ end }}
